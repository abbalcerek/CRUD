<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
</head>
<body>

<div class="container">

  <div class="jumbotron">
    <h1>User CRUD</h1>
    <p>(create read update delete)</p>
  </div>

  <div class="panel panel-default">
    <div class="panel-body">
      <form id="userForm" class="form-horizontal">
        <div class="form-group">
          <label for="firstName">First Name</label><br>
          <input type="text" name="firstName" id="firstName" class="form-control">
        </div>
        <div class="form-group">
          <label for="lastName">Last Name</label><br>
          <input type="text" name="lastName" id="lastName" class="form-control">
        </div>
        <div class="form-group">
          <label for="age">Age</label><br>
          <input type="number" name="age" min="1" id="age" class="form-control">
        </div>
        <div class="form-group">
          <label for="phoneNumber">Phone Number</label><br>
          <input type="text" name="phoneNumber" id="phoneNumber" class="form-control">
        </div>
        <input type="button" class="btn btn-primary" value="submit" onclick="addUser()">
      </form>
    </div>
    <div id="users">
      <ul id="userList" class="list-group"></ul>
    </div>
  </div>
</div>

<script type="text/javascript">
  let path = "http://localhost:8081/";

  $.get(`${path}users`, function(data) {
    $.each(data, function(index, user) {
      console.log(user.id);
      appendUser(user)
    });
  });

  let addUser = function () {

    let form = {};
    let formHtml = $('#userForm');
    $.each(formHtml.serializeArray(), function (i, field) {
      form[field.name] = field.value || "";
    });

    $.ajax({
      type: "POST",
      url: `${path}saveUser`,
      data: JSON.stringify(form),
      success: function(user) {
        appendUser(user);
        formHtml.reset();
      },
      contentType:'application/json',
      dataType: "json"
    });
  };
  
  let removeUser = function (userId) {
    $.ajax({
      type: "DELETE",
      url: `${path}deleteUser/${userId}`,
      success: function() {
        $(`#user-${userId}`).remove();
      }
    });
  };

  let editUser = function (userId) {
    alert(`Updating user with id: ${userId}`);
  };

  let appendUser = function (user) {
    $("#userList").append(
      `<li id="user-${user.id}" class="list-group-item">name: ${user.firstName} ${user.lastName}
         <br> phone: ${user.phoneNumber}
         <br>age: ${user.age}
         <br><button class="btn btn-default" onclick="removeUser(${user.id})" id="delete-${user.id}">delete</button>
         <button class="btn btn-default" onclick="editUser(${user.id})" id="update-${user.id}">update</button>
       </li>`);
  }
</script> 
</body>
</html>
